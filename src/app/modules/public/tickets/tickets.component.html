<div class="page-container-full animated fadeIn">

  <div *ngIf="loading">
    <app-spinner text="Loading tickets..."></app-spinner>
  </div>

  <div *ngIf="!loading && customer" class="sm d-flex justify-content-end py-3 px-2 text-accent">
    <!-- social header -->
    <div class="mdi mdi-account-circle mx-1"></div>
    <div>
      {{customer.tx_email}}
    </div>
    <div class="pointer text-warn ml-2" (click)="publicService.clearPublicSession()">
      [Salir]
    </div>
  </div>

</div>

<!-- CARD TICKETS -->
<div class="tickets-container">
  <div class="ticket-card" *ngFor="let ticket of ticketsActive">

    <!-- first image in banners -->
    <!-- <div *ngIf="ticket.id_company?.tx_company_banners.length > 0">
      <img class="company-banner img-fluid"
        [src]="ticket.id_company?.tx_company_banners[0] | imagenPipe : 'tx_company_banners' : ticket.id_company?._id">
    </div> -->

    <!-- no images in banners shows default image -->
    <!-- <div *ngIf="ticket.id_company?.tx_company_banners.length === 0">
      <img class="company-banner img-fluid" [src]="null | imagenPipe : 'tx_company_banners' : null">
    </div> -->

    <!-- card with ticket data -->
    <mat-card class="p-2">

      <!-- logo -->
      <img class="company-logo img-fluid"
        [src]="ticket.id_company?.tx_company_logo | imagenPipe : 'tx_company_logo' : ticket.id_company?._id">

      <!-- header with company name and address -->
      <div class="pointer" routerLink="/public/{{ticket.id_company.tx_company_string}}">
        <div class="ticket-card-company-name"> {{ticket.id_company?.tx_company_name}} </div>
        <div class="ticket-card-company-address"> {{ticket.id_company?.tx_address_street}}
          {{ticket.id_company?.tx_address_number}}</div>
      </div>

      <div class="ticket-card-tm-reserve mt-2">
        <div>
          A nombre de {{ticket.tx_name}}
        </div>
      </div>

      <div class="ticket-card-tm-reserve mt-2">
        <div>
          {{ticket.tm_reserve | dateToString : 'DD [de] MMMM [a las] HH:mm'}}
        </div>
        <div>
          ( {{ticket.tm_reserve | dateToRemaining}} )
        </div>
      </div>

      <div class="ticket-card-status mt-2 text-accent">
        {{ticket.tx_status | ticketStatus}}
      </div>

      <hr class="my-1 mt-3">
      <button mat-button color="active" routerLink="/public/ticket/{{ticket._id}}"
        *ngIf="ticket?.tm_provided && !ticket.tm_end">
        Â¡Comenzar!
      </button>

      <button mat-button color="warn" [disabled]="ticket.tx_status==='cancelled' || ticket.tx_status==='finished'"
        (click)="endTicket(ticket)">
        Cancelar
      </button>

      <button mat-button color="active" *ngIf="ticket.tx_status==='waiting'" (click)="validateTicket(ticket)">
        Confirmar
      </button>


    </mat-card>

  </div>
</div>

<div *ngIf="ticketsInactive.length > 0 && (social || customer)" class="page-container">
  <mat-card>

    <mat-card-header>
      <span class="mdi mdi-ticket xxxl mr-2 mb-1 op2" mat-card-avatar></span>

      <mat-card-title class="text-accent">
        Historial de reservas
      </mat-card-title>
      <mat-card-subtitle>
        Historial de reservas
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <table class="sm text-center">
        <thead>
          <tr class="text-info">
            <td class="text-left">
              Bar - Restaurante
            </td>
            <td class="text-left">
              Fecha de Reserva
            </td>
            <td class="text-right">
              Estado
            </td>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let ticket of ticketsInactive">

            <td class="text-left" *ngIf="ticket.id_company">
              <div class="pointer text-info" routerLink="/public/{{ticket.id_company.tx_company_string}}">
                {{ticket.id_company.tx_company_name}}
              </div>
            </td>
            <td class="text-left" *ngIf="!ticket.id_company">
              <div class="pointer text-info">
                Comercio eliminado
              </div>
            </td>

            <td class="text-left">
              {{ticket.tm_reserve | dateToString : 'DD/MM HH:mm'}} <span class="sm text-accent">(
                {{ticket.tm_reserve | dateToRemaining}} )</span>
            </td>
            <td class="text-right text-warn">
              {{ticket.tx_status}}
            </td>
          </tr>
        </tbody>
      </table>
    </mat-card-content>

  </mat-card>

</div>